---
title: Add ACL rules to linux firewall using iptables
date: 2020-12-22
tags:
  - firewall
  - iptables
  - linux
---

Runbook for adding security rules to a linux firewall using iptables to allow traffic for different communications flows.

Problem
=======

Allow traffic on a linux server functioning as a firewall using iptables:

Sources:
  - 10.10.30.0/24
  - 10.10.40.0/24

Destinations:
  - 10.30.10.0/24
  - 10.30.20.0/24

Ports:
  - TCP 1433
  - TCP 22

Solution
========

Export ruleset
--------------

```
iptables-save > iptables-ruleset
```

Object creation
---------------

Edit file `iptables-ruleset` with a text editor like `vim`

```
:SOURCES - [0:0]
:DESTINATIONS - [0:0]
:POLICY - [0:0]
```

Rule definition
---------------

```
-A FORWARD -p tcp -m multiport --dports 22,1433 -m state --state NEW -j SOURCES
-A SOURCES -s 10.10.30.0/24 -j DESTINATIONS
-A SOURCES -s 10.10.40.0/24 -j DESTINATIONS
-A DESTINATIONS -d 10.30.10.0/24 -j POLICY
-A DESTINATIONS -d 10.30.20.0/24 -j POLICY
-A POLICY -j LOG --log-prefix "POLICY_LOG:" --log-level 6
-A POLICY -j ACCEPT
```

Activate ruleset
----------------

```
iptables-restore < iptables-ruleset
```

More info
=========

- [Iptables tutorial](https://www.hostinger.com/tutorials/iptables-tutorial)
- [Iptables on Fedora](https://fedoraproject.org/wiki/How_to_edit_iptables_rules)
- [iptables log](https://stackoverflow.com/questions/21771684/iptables-log-and-drop-in-one-rule)